{% extends "base.html" %}
{% block title %}EY{% endblock %}
{% block content %}
<div class="page-header">
    <h1 class="page-title">My Files</h1>
    <div class="header-actions">
        <a href="{{ url_for('upload') }}" class="btn btn-primary">
            + Upload New File
        </a>
        <a href="{{ url_for('create_bundle') }}" class="btn btn-secondary">
            📦 Create Bundle
        </a>
    </div>
</div>

<!-- Statistics -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon yellow">📁</div>
        <div class="stat-details">
            <h3>{{ stats.total_files }}</h3>
            <p>Total Files</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon green">🌍</div>
        <div class="stat-details">
            <h3>{{ stats.public_files }}</h3>
            <p>Public Files</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon dark">🔒</div>
        <div class="stat-details">
            <h3>{{ stats.private_files }}</h3>
            <p>Private Files</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon yellow">💾</div>
        <div class="stat-details">
            <h3>{{ (stats.total_size / 1024 / 1024) | round(2) }} MB</h3>
            <p>Used Space</p>
        </div>
    </div>
</div>

<!-- Tab Navigation -->
<div class="dashboard-tabs">
    <button class="tab-btn active" onclick="showTab(event, 'files-tab')">📁 Files</button>
    <button class="tab-btn" onclick="showTab(event, 'bundles-tab')">📦 Bundles</button>
</div>

<!-- Files Tab -->
<div id="files-tab" class="tab-content active">
    <div class="card">
        {% if files %}
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>File</th>
                        <th>Type</th>
                        <th>Size</th>
                        <th>Status</th>
                        <th>Downloads</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for file in files %}
                    <tr>
                        <td class="file-name">{{ file[1] }}</td>
                        <td><span class="file-type-badge">{{ file[6] }}</span></td>
                        <td>{{ (file[5] / 1024) | round(2) }} KB</td>
                        <td>
                            {% if file[2] %}
                                <span class="badge badge-public">Public</span>
                            {% else %}
                                <span class="badge badge-private">Private</span>
                            {% endif %}
                        </td>
                        <td>{{ file[7] }}</td>
                        <td>{{ file[4][:10] if file[4] else 'N/A' }}</td>
                        <td>
                            <div class="btn-group">
                                <a href="{{ url_for('shared_file', token=file[3]) }}" class="btn btn-sm btn-secondary">View</a>
                                <a href="{{ url_for('toggle_public', file_id=file[0]) }}" class="btn btn-sm btn-primary">
                                    {% if file[2] %}🔒{% else %}🌍{% endif %}
                                </a>
                                <button onclick="copyLink('{{ request.url_root }}file/{{ file[3] }}')" class="btn btn-sm btn-secondary">📋</button>
                                <a href="{{ url_for('delete_file', file_id=file[0]) }}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure?')">🗑️</a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">📁</div>
            <h3>You haven't uploaded any files yet</h3>
            <p>Start by uploading your first file</p>
            <a href="{{ url_for('upload') }}" class="btn btn-primary">Upload File</a>
        </div>
        {% endif %}
    </div>
</div>

<!-- Bundles Tab -->
<div id="bundles-tab" class="tab-content">
    <div class="card">
        {% if bundles %}
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Bundle Name</th>
                        <th>Transaction #</th>
                        <th>Status</th>
                        <th>Downloads</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for bundle in bundles %}
                    <tr>
                        <td class="file-name">{{ bundle[1] }}</td>
                        <td>{{ bundle[2] }}</td>
                        <td>
                            {% if bundle[3] %}
                                <span class="badge badge-public">Public</span>
                            {% else %}
                                <span class="badge badge-private">Private</span>
                            {% endif %}
                        </td>
                        <td>{{ bundle[6] }}</td>
                        <td>{{ bundle[5][:10] if bundle[5] else 'N/A' }}</td>
                        <td>
                            <div class="btn-group">
                                <a href="{{ url_for('shared_bundle', token=bundle[4]) }}" class="btn btn-sm btn-secondary">👁️</a>
                                <a href="{{ url_for('edit_bundle', bundle_id=bundle[0]) }}" class="btn btn-sm btn-primary">✏️</a>
                                <a href="{{ url_for('toggle_bundle_public', bundle_id=bundle[0]) }}" class="btn btn-sm btn-primary">
                                    {% if bundle[3] %}🔒{% else %}🌍{% endif %}
                                </a>
                                <button onclick="copyLink('{{ request.url_root }}bundle/{{ bundle[4] }}')" class="btn btn-sm btn-secondary">📋</button>
                                <a href="{{ url_for('download_bundle', token=bundle[4]) }}" class="btn btn-sm btn-success">⬇️</a>
                                <a href="{{ url_for('delete_bundle', bundle_id=bundle[0]) }}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this bundle?')">🗑️</a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">📦</div>
            <h3>You haven't created any bundles yet</h3>
            <p>Create a bundle to group multiple files together</p>
            <a href="{{ url_for('create_bundle') }}" class="btn btn-primary">Create Bundle</a>
        </div>
        {% endif %}
    </div>
</div>

<script>
function showTab(evt, tabName) {
    var i, tabcontent, tablinks;
    
    // Hide all tab content
    tabcontent = document.getElementsByClassName("tab-content");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].classList.remove("active");
    }
    
    // Remove active class from all tab buttons
    tablinks = document.getElementsByClassName("tab-btn");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].classList.remove("active");
    }
    
    // Show the selected tab and mark button as active
    document.getElementById(tabName).classList.add("active");
    evt.currentTarget.classList.add("active");
}
</script>
{% endblock %}