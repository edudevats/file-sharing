{% extends "base.html" %}
{% block title %}{{ file[10] if file[10] else file[2] }} - EY{% endblock %}
{% block content %}
<div class="card file-view">
    <div class="file-header">
        <div class="file-header-content">
            {% if logo %}
                <img src="{{ url_for('serve_logo', filename=logo) }}" alt="Logo" class="file-view-logo">
            {% endif %}
            <div class="file-title-section">
                <h2>{{ file[10] if file[10] else file[2] }}</h2>
                {% if file[10] %}
                    <small class="file-subtitle">{{ file[2] }}</small>
                {% endif %}
                {% if current_user.is_authenticated %}
                    {% if file[4] %}
                        <span class="badge badge-public">Public</span>
                    {% else %}
                        <span class="badge badge-private">Private</span>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Back to Main File Button -->
    {% if bundle %}
    <div style="margin: 1rem 0; padding-top: 1rem; border-top: 1px solid #e0e0e0;">
        <a href="{{ url_for('shared_bundle', token=bundle.share_token) }}" class="btn btn-secondary btn-sm">
            üìÇ ‚Üê Back to Main File
        </a>
    </div>
    {% endif %}
    
    <!-- Document preview -->
    <div class="file-preview">
        {% set file_extension = file[8].lower() %}
        {% if file_extension in ['jpg', 'jpeg', 'png', 'gif'] %}
            <div class="image-preview">
                <img src="{{ url_for('view_file_content', token=file[5]) }}" alt="{{ file[2] }}" class="preview-image">
            </div>
        {% elif file_extension == 'pdf' %}
            <div class="pdf-preview-mobile">
                <object data="{{ url_for('view_file_content', token=file[5]) }}" type="application/pdf" class="preview-pdf-mobile">
                    <embed src="{{ url_for('view_file_content', token=file[5]) }}" type="application/pdf" class="preview-pdf-mobile" />
                    <div class="pdf-fallback-mobile">
                        <div class="fallback-content">
                            <div class="fallback-icon">üìÑ</div>
                            <p>PDF preview not available on this device</p>
                            <p><small>Use the download or open buttons below</small></p>
                        </div>
                    </div>
                </object>
            </div>
        {% else %}
            <div class="file-icon-preview">
                <div class="file-icon">
                    {% if file_extension in ['doc', 'docx'] %}
                        <i class="file-icon-doc">üìÑ</i>
                    {% elif file_extension == 'txt' %}
                        <i class="file-icon-txt">üìù</i>
                    {% elif file_extension == 'zip' %}
                        <i class="file-icon-zip">üóúÔ∏è</i>
                    {% else %}
                        <i class="file-icon-default">üìÅ</i>
                    {% endif %}
                </div>
                <p class="preview-message">Preview not available for this file type</p>
            </div>
        {% endif %}
    </div>
    
    
    {% if current_user.is_authenticated %}
    <div class="file-details-mobile">
        <h3 class="details-title-mobile">File Information</h3>
        <div class="details-grid-mobile">
            <div class="detail-item-mobile">
                <span class="detail-label">Type:</span>
                <span class="detail-value">{{ file[8] }}</span>
            </div>
            <div class="detail-item-mobile">
                <span class="detail-label">Size:</span>
                <span class="detail-value">{{ (file[7] / 1024) | round(2) }} KB</span>
            </div>
            <div class="detail-item-mobile">
                <span class="detail-label">Date:</span>
                <span class="detail-value">{{ file[6][:10] if file[6] else 'N/A' }}</span>
            </div>
            <div class="detail-item-mobile">
                <span class="detail-label">Downloads:</span>
                <span class="detail-value">{{ file[9] }}</span>
            </div>
        </div>
    </div>
    
    <div class="share-section-mobile">
        <h3 class="share-title-mobile">Share this file</h3>
        <div class="share-input-mobile">
            <input type="text" value="{{ request.url }}" readonly class="form-control-mobile" id="shareUrl">
            <button onclick="copyLink('{{ request.url }}')" class="btn btn-primary btn-mobile copy-btn">
                üìã Copy Link
            </button>
        </div>
    </div>
    {% endif %}
    
    <div class="file-actions-universal">
        <div class="main-actions">
            <a href="{{ url_for('download_file', token=file[5]) }}" class="btn btn-primary btn-mobile btn-download">
                ‚¨áÔ∏è Download File
            </a>
            {% set file_extension = file[8].lower() %}
            {% if file_extension == 'pdf' %}
            <a href="{{ url_for('view_file_content', token=file[5]) }}" class="btn btn-secondary btn-mobile" target="_blank">
                üëÅÔ∏è View
            </a>
            {% endif %}
        </div>
        {% if current_user.is_authenticated and current_user.id == file[3] %}
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary btn-mobile btn-dashboard">
            ‚Üê Dashboard
        </a>
        {% endif %}
    </div>
</div>
{% endblock %}